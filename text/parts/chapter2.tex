\chapter{Предлагаемые методы настройки параметров ЭА}
\label{proposed_chapter}
\section{Цель работы}
Существует метод адаптивной настройки параметров ЭА с помощью обучения с подкреплением, позволяющий адаптивно выделять состояния среды. Множество действий агента определяется разбиением диапазона допустимых значений параметра, которое задается до начала выполнения алгоритма. Также существуют методы настройки параметров ЭА, позволяющие адаптивно разбивать диапазон допустимых значений параметра.

В данной работе предлагается исследовать эффективность адаптивного выделения множества действий агента за счет разбиения диапазона допустимых значений параметра в ходе работы алгоритма. Целью исследований являлась разработка метода адаптивной настройки параметров эволюционного алгоритма с помощью обучения с подкреплением. Предлагаемый алгоритм на основе обучения с подкреплением должен формировать множество действий агента во время работы, адаптивно разбивая диапазон допустимых значений параметра.

\section{Метод на основе алгоритмов earpc и UTree}
\label{composing_method}
Данный метод является объединением методов \textit{earpc}~(\ref{earpc}) и \textit{UTree}~(\ref{utree}). В отличие от метода, предложенного Karafotias et al.~(\ref{karafotias}), выбор значений параметров происходит с помощью алгоритма \textit{earpc}. В процессе работы по наблюдаемым характеристикам ЭА строится дерево решений \textit{UTree}. Алгоритм \textit{earpc} выбирает значения параметров на основе сохраненных в листе переходов $(I, a, I', r)$. Для оценки качества выбранного назначения параметров для алгоритма \textit{earpc} используется награда, получаемая агентом. Таким образом, необходимо по наблюдаемым значениям ЭА найти лист дерева \textit{UTree}. Затем значения параметров выбираются при помощи алгоритма \textit{earpc}, используя переходы, хранящиеся в найденном листе.

При построении дерева \textit{UTree}, необходимо определить способ разбиения листа на два состояния. Для применения критерия разбиения Колмогорова-Смирнова, для каждого перехода $(I, a, I', r)$, сохраненного в листе, вычисляется значение $q(I, a) = r + \gamma V(s')$, где $s'$!~-- лист, соответствующий характеристикам ЭА $I'$. При этом необходимо посчитать ожидаемую награду $V(s')$. В качестве $V(s')$ предлагается использовать математическое ожидание награды в листе $s'$. Алгоритм \textit{earpc} разбивает диапазон значений параметра на два подинтервала, один из которых выбирается с вероятностью пропорциональной средней награде на подинтервале. Таким образом $V(s')$ вычисляется по формуле $V(s') = \sum\limits_{i = 1}^2{\frac{Q_i^2}{Q_1 + Q_2}}$, где $Q_1$ и $Q_2$ средние значения награды на первом и втором подинтервале соответственно. 

Кроме того, после выделения новых состояний среды необходимо пересчитать значения ожидаемой награды для полученных состояний. В методе, предложенном \textit{Karafotias et al}., значения $Q(s, a)$, где $s$~-- разбиваемое состояние, копировались в новые состояния, то есть значения ожидаемой награды для полученных состояний не пересчитывались. В предлагаемом подходе при выделении нового состояния в соответствии с алгоритмом \textit{UTree} множество переходов перераспределяется между полученными состояниями. Таким образом значения ожидаемой награды пересчитываются автоматически при следующей итерации алгоритма \textit{earpc}.

\section{Метод с адаптивным выделением множества действий}
\label{adaptive_method}

Также в данной работе предлагается метод адаптивной настройки параметров ЭА с помощью $Q$-обучения с адаптивным выделением множества действий. В данном подходе действие определяется аналогично методу, предложенному \textit{Karafotias et al}. Однако разбиение диапазона допустимых значений параметров меняется в ходе работы алгоритма.

Агент выбирает действие на основе алгоритма $Q$-обучения с $\varepsilon$-жадной стратегией исследования среды. В случае когда значения ожидаемой награды примерно одинаковы для всех воможных действий, агент не может выбрать какое из действий наиболее эффективно. Поэтому в данном случае текущее разбиение диапазонов значения параметров пересчитывается. При этом в следствие изменения разбиения меняется множество допустимых действий агента.

В процессе работы алгоритма сохраняются выбранные назначения параметров и полученные за эти назначения награды.  Сохраненные данные используются при переразбиении диапазона значений для каждого из настраиваемых параметров. Опишем процедуру переразбиения диапазона. Сначала диапазон делится на два подинтервала при помощи критерия Колмогорова-Смирнова. На каждой следующей итерации разбиения диапазона, полученные на текущей итерации подинтервалы при помощи критерия Колмогорова-Смирнова разбиваются на два подинтервала. В случае, если точка разбиения подинтервала не найдена, разбиение интервала не происходит. Таким образом, максимальное число подинтервалов на которые разбивается диапазон допустимых значений параметра равен $2^i$, где $i$~-- число итераций разбиения диапазона. На листинге~\ref{dist_scheme} представлен алгоритм разбиения диапазона для $i = 2$.


\begin{algorithm}[h!]
    \caption{Алгоритм разбиения диапазона с двумя итерациями в методе с адаптивным выделением множества действий.}
    \label{dist_scheme}
    \begin{algorithmic}[1]
	\REQUIRE  
	  \textit{V} --- множество назначений параметров;
        \FOR {параметр \textit{v}}
	  \STATE {Разбиение $P \gets \emptyset$}
	  \STATE {Отсортировать множество назначений по параметру \textit{v}}
	  \STATE {С помощью критерия Колмогорова-Смирнова найти точку разбиения \textit{s} множества \textit{V}}
	  \IF {Точка разбиения \textit{s} не найдена}
	    \STATE {$P \gets \{[v_{min}, v_{max}]\}$}
	  \ELSE
	    \STATE {Разбить множество \textit{V} на \textit{L} и \textit{R} в соответствии с \textit{s}}
	    \STATE {Найти точку разбиения $s_l$ для множества \textit{L}}
	    \STATE {Найти точку разбиения $s_r$ для множества \textit{R}}
	    \IF {Точки разбиения $s_l$ и $s_r$ не найдены}
	      \STATE {$P \gets \{[v_{min}, s], (s, v_{max}]\}$}
	    \ELSIF {Точка разбиения $s_l$ не найдена}
	      \STATE {$P \gets \{[v_{min}, s], (s, s_r], (s_r, v_{max}]\}$}
	     \ELSIF {Точка разбиения $s_r$ не найдена}
	      \STATE {$P \gets \{[v_{min}, s_l], (s_l, s], (s, v_{max}]\}$}
	     \ELSE
	      \STATE {$P \gets \{[v_{min}, s_l], (s_l, s], (s, s_r], (s_r, v_{max}]\}$}
	    \ENDIF
	  \ENDIF
        \ENDFOR
    \end{algorithmic}
\end{algorithm}